(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[741],{9451:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/host/inventory/[propertyId]/add-product",function(){return r(2233)}])},7068:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(5893),a=r(7294),s=r(1664),i=r.n(s),o=r(1163);function l(e){let{cancelHref:t,cancelText:r="Cancel",submitText:s="Save",loading:l=!1,loadingText:c="Saving...",danger:d=!1,onCancel:u,customCancelClass:m="",customSubmitClass:h=""}=e,[p,f]=(0,a.useState)(!1),[x,b]=(0,a.useState)(0),y=(0,o.useRouter)();(0,a.useEffect)(()=>{let e;return l?e=setInterval(()=>{b(e=>{let t=e+1;return t>=10&&!p&&f(!0),t})},1e3):(b(0),f(!1)),()=>{e&&clearInterval(e)}},[l,p]);let g="\n    px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 \n    transition cursor-pointer ".concat(m,"\n  ");return(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center pt-4",children:[t?(0,n.jsx)(i(),{href:t,children:(0,n.jsx)("span",{className:g,children:r})}):(0,n.jsx)("button",{type:"button",onClick:u,className:g,children:r}),(0,n.jsx)("button",{type:"submit",disabled:l,className:d?"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 \n       transition cursor-pointer ".concat(h):"px-4 py-2 bg-[#fad02f] text-black rounded hover:opacity-90 \n       transition font-semibold ".concat(h),children:l?(0,n.jsxs)("span",{className:"flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),c," (",x,"s)"]}):s})]}),p?(0,n.jsxs)("div",{className:"text-xs text-red-500 mt-2",children:[(0,n.jsx)("p",{children:"Richiesta bloccata. Puoi:"}),(0,n.jsxs)("div",{className:"flex space-x-4 mt-1",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{t?y.push(t):u?u():y.back()},className:"text-blue-500 underline",children:"Annulla"}),(0,n.jsx)("button",{type:"button",onClick:()=>{window.location.reload()},className:"text-blue-500 underline",children:"Riprova"})]})]}):null]})}},9555:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(5893),a=r(7294),s=r(1163),i=r(5482);function o(e){let{children:t}=e,{user:r,loading:o,authInitialized:l}=(0,i.a)(),c=(0,s.useRouter)(),[d,u]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let e=setTimeout(()=>{d&&(console.warn("Route verification timed out, forcing completion"),r||c.push("/auth/signin"),u(!1))},5e3);return!o&&l&&(r?u(!1):(console.log("No user found, redirecting to login"),c.push("/auth/signin"))),()=>clearTimeout(e)},[r,o,l,c,d]),o||d)?(0,n.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):(0,n.jsx)(n.Fragment,{children:t})}},430:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var n=r(5893),a=r(9008),s=r.n(a),i=r(1664),o=r.n(i),l=r(5675),c=r.n(l);r(1163);var d=r(5482);function u(e){let{children:t,title:r="Guestify"}=e,{user:a,signOut:i}=(0,d.a)();return(0,n.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50 text-gray-800",children:[(0,n.jsxs)(s(),{children:[(0,n.jsx)("title",{children:r}),(0,n.jsx)("meta",{name:"description",content:"Guestify - Food service for Airbnb hosts"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)("header",{className:"bg-[#5e2bff] p-4 shadow-md rounded-b-xl",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto flex justify-between items-center",children:[(0,n.jsx)("div",{className:"flex items-center",children:a?(0,n.jsx)(o(),{href:"/host/dashboard",children:(0,n.jsx)("span",{className:"cursor-pointer",children:(0,n.jsx)(c(),{src:"/images/guestify_logo.png",alt:"Guestify",width:40,height:40,quality:100,className:"h-10 w-auto object-contain",priority:!0})})}):(0,n.jsx)("span",{children:(0,n.jsx)(c(),{src:"/images/guestify_logo.png",alt:"Guestify",width:40,height:40,quality:100,className:"h-10 w-auto object-contain",priority:!0})})}),(0,n.jsx)("nav",{className:"flex items-center",children:a?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o(),{href:"/host/dashboard",children:(0,n.jsx)("span",{className:"mx-1 sm:mx-2 text-white font-semibold hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Dashboard"})}),(0,n.jsx)("button",{onClick:i,className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base bg-transparent border-none cursor-pointer",children:"Logout"}),(0,n.jsx)(o(),{href:"/host/profile",children:(0,n.jsx)("span",{className:"ml-2 cursor-pointer flex items-center",children:(0,n.jsx)("div",{className:"h-8 w-8 rounded-full bg-white text-[#5e2bff] flex items-center justify-center",children:(0,n.jsx)("i",{className:"fas fa-smile"})})})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o(),{href:"/auth/signin",children:(0,n.jsx)("span",{className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Login"})}),(0,n.jsx)(o(),{href:"/auth/signup",children:(0,n.jsx)("span",{className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Signup"})})]})})]})}),(0,n.jsx)("main",{className:"max-w-6xl mx-auto my-4 p-2 sm:p-4 rounded-xl flex-grow w-full",children:t}),(0,n.jsx)("footer",{className:"bg-[#5e2bff] p-4 rounded-t-xl",children:(0,n.jsx)("div",{className:"max-w-6xl mx-auto text-center text-white text-sm",children:(0,n.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," Guestify"]})})})]})}},2602:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return o},noSSR:function(){return i}});let n=r(260);r(5893),r(7294);let a=n._(r(5491));function s(e){return{default:(null==e?void 0:e.default)||e}}function i(e,t){return delete t.webpack,delete t.modules,e(t)}function o(e,t){let r=a.default,n={loading:e=>{let{error:t,isLoading:r,pastDelay:n}=e;return null}};e instanceof Promise?n.loader=()=>e:"function"==typeof e?n.loader=e:"object"==typeof e&&(n={...n,...e});let o=(n={...n,...t}).loader;return(n.loadableGenerated&&(n={...n,...n.loadableGenerated},delete n.loadableGenerated),"boolean"!=typeof n.ssr||n.ssr)?r({...n,loader:()=>null!=o?o().then(s):Promise.resolve(s(()=>null))}):(delete n.webpack,delete n.modules,i(r,n))}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1159:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LoadableContext",{enumerable:!0,get:function(){return n}});let n=r(260)._(r(7294)).default.createContext(null)},5491:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return m}});let n=r(260)._(r(7294)),a=r(1159),s=[],i=[],o=!1;function l(e){let t=e(),r={loading:!0,loaded:null,error:null};return r.promise=t.then(e=>(r.loading=!1,r.loaded=e,e)).catch(e=>{throw r.loading=!1,r.error=e,e}),r}class c{promise(){return this._res.promise}retry(){this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};let{_res:e,_opts:t}=this;e.loading&&("number"==typeof t.delay&&(0===t.delay?this._state.pastDelay=!0:this._delay=setTimeout(()=>{this._update({pastDelay:!0})},t.delay)),"number"==typeof t.timeout&&(this._timeout=setTimeout(()=>{this._update({timedOut:!0})},t.timeout))),this._res.promise.then(()=>{this._update({}),this._clearTimeouts()}).catch(e=>{this._update({}),this._clearTimeouts()}),this._update({})}_update(e){this._state={...this._state,error:this._res.error,loaded:this._res.loaded,loading:this._res.loading,...e},this._callbacks.forEach(e=>e())}_clearTimeouts(){clearTimeout(this._delay),clearTimeout(this._timeout)}getCurrentValue(){return this._state}subscribe(e){return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}constructor(e,t){this._loadFn=e,this._opts=t,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}}function d(e){return function(e,t){let r=Object.assign({loader:null,loading:null,delay:200,timeout:null,webpack:null,modules:null},t),s=null;function l(){if(!s){let t=new c(e,r);s={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return s.promise()}if(!o){let e=r.webpack?r.webpack():r.modules;e&&i.push(t=>{for(let r of e)if(t.includes(r))return l()})}function d(e,t){!function(){l();let e=n.default.useContext(a.LoadableContext);e&&Array.isArray(r.modules)&&r.modules.forEach(t=>{e(t)})}();let i=n.default.useSyncExternalStore(s.subscribe,s.getCurrentValue,s.getCurrentValue);return n.default.useImperativeHandle(t,()=>({retry:s.retry}),[]),n.default.useMemo(()=>{var t;return i.loading||i.error?n.default.createElement(r.loading,{isLoading:i.loading,pastDelay:i.pastDelay,timedOut:i.timedOut,error:i.error,retry:s.retry}):i.loaded?n.default.createElement((t=i.loaded)&&t.default?t.default:t,e):null},[e,i])}return d.preload=()=>l(),d.displayName="LoadableComponent",n.default.forwardRef(d)}(l,e)}function u(e,t){let r=[];for(;e.length;){let n=e.pop();r.push(n(t))}return Promise.all(r).then(()=>{if(e.length)return u(e,t)})}d.preloadAll=()=>new Promise((e,t)=>{u(s).then(e,t)}),d.preloadReady=e=>(void 0===e&&(e=[]),new Promise(t=>{let r=()=>(o=!0,t());u(i,e).then(r,r)})),window.__NEXT_PRELOADREADY=d.preloadReady;let m=d},2233:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(5893),a=r(7294),s=r(1163),i=r(1664),o=r.n(i),l=r(5152),c=r.n(l),d=r(430),u=r(5240),m=r(9555),h=r(7068);let p=c()(()=>Promise.all([r.e(430),r.e(916),r.e(389)]).then(r.bind(r,4389)),{loadableGenerated:{webpack:()=>[4389]},ssr:!1});function f(){let[e,t]=(0,a.useState)({barcode:"",name:"",price:"",quantity:"1",description:"",category:"Food and Drinks",image_url:""}),[r,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(""),[d,m]=(0,a.useState)(!1),[f,x]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[g,j]=(0,a.useState)(!1),[v,w]=(0,a.useState)(!1),_=(0,s.useRouter)(),{propertyId:N}=_.query;(0,a.useEffect)(()=>{_.query.barcode&&k(_.query.barcode)},[_.query]);let k=async e=>{try{m(!0),console.log("Searching for product with barcode: ".concat(e));let{data:r,error:n}=await u.OQ.from("products").select("*").eq("barcode",e).single();if(n&&"PGRST116"!==n.code)throw n;if(r){console.log("Product found:",r),w(!0);let{data:e,error:n}=await u.OQ.from("inventory").select("*").eq("product_id",r.id).eq("apartment_id",N).maybeSingle();n&&"PGRST116"!==n.code&&console.error("Error checking inventory:",n),t({barcode:r.barcode||"",name:r.name||"",description:r.description||"",category:r.category||"Food and Drinks",image_url:r.image_url||"",price:e?e.price:"",quantity:"1"}),r.image_url&&c(r.image_url),e?y("This product is already in your inventory with quantity ".concat(e.quantity,". You can add more.")):(j("Product found in database! Details loaded. Enter quantity and price to add to inventory."),setTimeout(()=>j(!1),3e3))}else console.log("Product not found, only setting barcode"),t(t=>({...t,barcode:e})),w(!1)}catch(e){console.error("Error fetching product by barcode:",e),y("Failed to fetch product information")}finally{m(!1)}},P=e=>{let{name:r,value:n,type:a}=e.target;if("file"===a){let t=e.target.files[0];if(i(t),t){let e=URL.createObjectURL(t);return c(e),()=>URL.revokeObjectURL(e)}}else t(e=>({...e,[r]:n}))},S=async t=>{t.preventDefault(),m(!0),y(null);try{let t,n=e.image_url;if(r){let e=r.name.split(".").pop(),t="".concat(Math.random().toString(36).substring(2,15),".").concat(e),a="product-images/".concat(t),{error:s}=await u.OQ.storage.from("guestify").upload(a,r);if(s)throw s;let{data:i}=u.OQ.storage.from("guestify").getPublicUrl(a);n=i.publicUrl}let{data:a,error:s}=await u.OQ.from("products").select("id").eq("barcode",e.barcode).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;if(a){let{data:r,error:s}=await u.OQ.from("products").update({name:e.name,description:e.description,category:e.category,image_url:n}).eq("id",a.id).select().single();if(s)throw s;t=r.id}else{let{data:r,error:a}=await u.OQ.from("products").insert([{barcode:e.barcode,name:e.name,description:e.description,category:e.category,image_url:n}]).select().single();if(a)throw a;t=r.id}let{data:i,error:o}=await u.OQ.from("inventory").select("id, quantity").eq("apartment_id",N).eq("product_id",t).maybeSingle();if(o&&"PGRST116"!==o.code)throw o;if(i){let t=i.quantity+parseInt(e.quantity),{error:r}=await u.OQ.from("inventory").update({quantity:t,price:parseFloat(e.price)}).eq("id",i.id);if(r)throw r}else{let{error:r}=await u.OQ.from("inventory").insert([{apartment_id:N,product_id:t,quantity:parseInt(e.quantity),price:parseFloat(e.price)}]);if(r)throw r}j(!0),setTimeout(()=>{_.push("/host/inventory/".concat(N))},1500)}catch(e){console.error("Error adding product:",e),y("Failed to add product: "+(e.message||"Unknown error")),m(!1)}};return(0,n.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md",children:[(0,n.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-xl font-bold",children:"Add Product"}),(0,n.jsx)(o(),{href:"/host/inventory/".concat(N),children:(0,n.jsx)("span",{className:"text-blue-500 hover:underline cursor-pointer",children:"Back to Inventory"})})]}),b&&(0,n.jsx)("div",{className:"bg-red-100 text-red-700 p-3 rounded mb-4",children:b}),g&&(0,n.jsx)("div",{className:"bg-green-100 text-green-700 p-3 rounded mb-4",children:"string"==typeof g?g:"Product added successfully! Redirecting..."}),v&&(0,n.jsx)("div",{className:"bg-blue-100 text-blue-700 p-3 rounded mb-4",children:"Product found in database! Fields have been auto-filled."}),(0,n.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Barcode:"}),(0,n.jsx)("button",{type:"button",onClick:f?()=>{x(!1)}:()=>{x(!0),y(null)},className:"".concat(f?"bg-red-500":"bg-blue-500"," text-white px-3 py-1 rounded text-sm hover:opacity-90 transition"),children:f?"Stop Scanning":"Scan Barcode"})]}),(0,n.jsx)("input",{type:"text",name:"barcode",value:e.barcode,onChange:P,className:"w-full border rounded px-3 py-2",placeholder:"Enter or scan barcode"})]}),f&&(0,n.jsx)("div",{className:"mb-4 rounded relative",children:(0,n.jsx)(p,{isScanning:f,onDetected:e=>{console.log("Barcode detected:",e),x(!1),t(t=>({...t,barcode:e})),k(e)},onError:e=>{console.error("Scanner error:",e),y("Scanner error: ".concat(e.message||"Cannot access camera")),x(!1)}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Name:"}),(0,n.jsx)("input",{type:"text",name:"name",value:e.name,onChange:P,className:"w-full border rounded px-3 py-2",placeholder:"Product name",required:!0})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Price (EUR):"}),(0,n.jsx)("input",{type:"number",step:"0.01",name:"price",value:e.price,onChange:P,className:"w-full border rounded px-3 py-2",placeholder:"0.00",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Quantity:"}),(0,n.jsx)("input",{type:"number",name:"quantity",value:e.quantity,onChange:P,className:"w-full border rounded px-3 py-2",placeholder:"1",min:"1",required:!0})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Description:"}),(0,n.jsx)("textarea",{name:"description",value:e.description,onChange:P,className:"w-full border rounded px-3 py-2 h-24",placeholder:"Product description"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Category:"}),(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsxs)("label",{className:"inline-flex items-center",children:[(0,n.jsx)("input",{type:"radio",name:"category",value:"Food and Drinks",checked:"Food and Drinks"===e.category,onChange:P,className:"mr-2",required:!0}),(0,n.jsx)("span",{children:"Food and Drinks"})]}),(0,n.jsxs)("label",{className:"inline-flex items-center",children:[(0,n.jsx)("input",{type:"radio",name:"category",value:"Articles",checked:"Articles"===e.category,onChange:P,className:"mr-2",required:!0}),(0,n.jsx)("span",{children:"Articles"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Image:"}),l&&(0,n.jsx)("div",{className:"mb-2",children:(0,n.jsx)("img",{src:l,alt:"Preview",className:"w-32 h-32 object-cover rounded border"})}),(0,n.jsx)("input",{type:"file",name:"image",onChange:P,accept:"image/*",className:"w-full border rounded px-3 py-2"})]}),(0,n.jsx)(h.Z,{cancelHref:"/host/inventory/".concat(N),submitText:"Add Product",loading:d,loadingText:"Adding..."})]})]})}f.getLayout=function(e){return(0,n.jsx)(d.Z,{title:"Add Product - Guestify",children:(0,n.jsx)(m.Z,{children:e})})}},5152:function(e,t,r){e.exports=r(2602)}},function(e){e.O(0,[61,888,774,179],function(){return e(e.s=9451)}),_N_E=e.O()}]);