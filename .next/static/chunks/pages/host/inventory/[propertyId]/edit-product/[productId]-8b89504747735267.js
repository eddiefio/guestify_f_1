(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[468],{1377:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/host/inventory/[propertyId]/edit-product/[productId]",function(){return r(8359)}])},7068:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var s=r(5893),n=r(7294),a=r(1664),i=r.n(a),c=r(1163);function l(e){let{cancelHref:t,cancelText:r="Cancel",submitText:a="Save",loading:l=!1,loadingText:o="Saving...",danger:d=!1,onCancel:u,customCancelClass:m="",customSubmitClass:x=""}=e,[h,p]=(0,n.useState)(!1),[f,g]=(0,n.useState)(0),b=(0,c.useRouter)();(0,n.useEffect)(()=>{let e;return l?e=setInterval(()=>{g(e=>{let t=e+1;return t>=10&&!h&&p(!0),t})},1e3):(g(0),p(!1)),()=>{e&&clearInterval(e)}},[l,h]);let j="\n    px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 \n    transition cursor-pointer ".concat(m,"\n  ");return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center pt-4",children:[t?(0,s.jsx)(i(),{href:t,children:(0,s.jsx)("span",{className:j,children:r})}):(0,s.jsx)("button",{type:"button",onClick:u,className:j,children:r}),(0,s.jsx)("button",{type:"submit",disabled:l,className:d?"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 \n       transition cursor-pointer ".concat(x):"px-4 py-2 bg-[#fad02f] text-black rounded hover:opacity-90 \n       transition font-semibold ".concat(x),children:l?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o," (",f,"s)"]}):a})]}),h?(0,s.jsxs)("div",{className:"text-xs text-red-500 mt-2",children:[(0,s.jsx)("p",{children:"Richiesta bloccata. Puoi:"}),(0,s.jsxs)("div",{className:"flex space-x-4 mt-1",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{t?b.push(t):u?u():b.back()},className:"text-blue-500 underline",children:"Annulla"}),(0,s.jsx)("button",{type:"button",onClick:()=>{window.location.reload()},className:"text-blue-500 underline",children:"Riprova"})]})]}):null]})}},9555:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var s=r(5893),n=r(7294),a=r(1163),i=r(5482);function c(e){let{children:t}=e,{user:r,loading:c,authInitialized:l}=(0,i.a)(),o=(0,a.useRouter)(),[d,u]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{l&&(r||c?r&&u(!1):(console.log("No user found, redirecting to signin"),o.replace("/auth/signin")));let e=setTimeout(()=>{d&&(console.log("Verification timed out, showing content anyway"),u(!1))},8e3);return()=>clearTimeout(e)},[r,c,l,o,d]),c||d&&!r)?(0,s.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"}),(0,s.jsx)("p",{className:"ml-3 text-gray-600",children:"Loading..."})]}):(0,s.jsx)(s.Fragment,{children:t})}},430:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var s=r(5893),n=r(9008),a=r.n(n),i=r(1664),c=r.n(i),l=r(5675),o=r.n(l);r(1163);var d=r(5482);function u(e){let{children:t,title:r="Guestify"}=e,{user:n,signOut:i}=(0,d.a)();return(0,s.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50 text-gray-800",children:[(0,s.jsxs)(a(),{children:[(0,s.jsx)("title",{children:r}),(0,s.jsx)("meta",{name:"description",content:"Guestify - Food service for Airbnb hosts"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,s.jsx)("header",{className:"bg-[#5e2bff] py-1 px-4 shadow-md rounded-b-xl",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto flex justify-between items-center",children:[(0,s.jsx)("div",{className:"flex items-center",children:n?(0,s.jsx)(c(),{href:"/host/dashboard",children:(0,s.jsx)("span",{className:"cursor-pointer",children:(0,s.jsx)(o(),{src:"/images/guestify_logo.png",alt:"Guestify",width:160,height:100,quality:100,priority:!0,className:"w-40 h-24",style:{objectFit:"contain"}})})}):(0,s.jsx)("span",{children:(0,s.jsx)(o(),{src:"/images/guestify_logo.png",alt:"Guestify",width:160,height:100,quality:100,priority:!0,className:"w-40 h-24",style:{objectFit:"contain"}})})}),(0,s.jsx)("nav",{className:"flex items-center",children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c(),{href:"/host/dashboard",children:(0,s.jsx)("span",{className:"mx-1 sm:mx-2 text-white font-semibold hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Dashboard"})}),(0,s.jsx)("button",{onClick:i,className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base bg-transparent border-none cursor-pointer",children:"Logout"}),(0,s.jsx)(c(),{href:"/host/profile",children:(0,s.jsx)("span",{className:"ml-2 cursor-pointer flex items-center",children:(0,s.jsx)("div",{className:"h-8 w-8 rounded-full bg-white text-[#5e2bff] flex items-center justify-center",children:(0,s.jsx)("i",{className:"fas fa-smile"})})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c(),{href:"/auth/signin",children:(0,s.jsx)("span",{className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Login"})}),(0,s.jsx)(c(),{href:"/auth/signup",children:(0,s.jsx)("span",{className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Signup"})})]})})]})}),(0,s.jsx)("main",{className:"max-w-6xl mx-auto my-4 p-2 sm:p-4 rounded-xl flex-grow w-full",children:t}),(0,s.jsx)("footer",{className:"bg-[#5e2bff] p-4 rounded-t-xl",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto text-center text-white text-sm",children:(0,s.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," Guestify"]})})})]})}},8359:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var s=r(5893),n=r(7294),a=r(1163),i=r(1664),c=r.n(i),l=r(5675),o=r.n(l),d=r(430),u=r(5240),m=r(9555),x=r(7068);function h(){let[e,t]=(0,n.useState)({barcode:"",name:"",price:"",quantity:"",description:"",category:"",image_url:""}),[r,i]=(0,n.useState)(null),[l,d]=(0,n.useState)(""),[m,h]=(0,n.useState)(!0),[p,f]=(0,n.useState)(!1),[g,b]=(0,n.useState)(null),[j,y]=(0,n.useState)(!1),N=(0,a.useRouter)(),{propertyId:v,productId:w}=N.query;(0,n.useEffect)(()=>{v&&w&&e();async function e(){try{h(!0);let{data:e,error:r}=await u.OQ.from("products").select("*").eq("id",w).single();if(r)throw r;let{data:s,error:n}=await u.OQ.from("inventory").select("*").eq("apartment_id",v).eq("product_id",w).single();if(n)throw n;t({barcode:e.barcode||"",name:e.name||"",price:s.price||"",quantity:s.quantity||"",description:e.description||"",category:e.category||"Food and Drinks",image_url:e.image_url||""}),e.image_url&&d(e.image_url)}catch(e){console.error("Error fetching product:",e),b("Failed to load product data")}finally{h(!1)}}},[v,w]);let k=e=>{let{name:r,value:s,type:n}=e.target;if("file"===n){let t=e.target.files[0];if(i(t),t){let e=URL.createObjectURL(t);return d(e),()=>URL.revokeObjectURL(e)}}else t(e=>({...e,[r]:s}))},_=async t=>{t.preventDefault(),f(!0),b(null);try{let t=e.image_url;if(r){let e=r.name.split(".").pop(),s="".concat(Math.random().toString(36).substring(2,15),".").concat(e),n="product-images/".concat(s),{error:a}=await u.OQ.storage.from("guestify").upload(n,r);if(a)throw a;let{data:i}=u.OQ.storage.from("guestify").getPublicUrl(n);t=i.publicUrl}let{error:s}=await u.OQ.from("products").update({barcode:e.barcode,name:e.name,description:e.description,category:e.category,image_url:t}).eq("id",w);if(s)throw s;let{error:n}=await u.OQ.from("inventory").update({quantity:parseInt(e.quantity),price:parseFloat(e.price)}).eq("apartment_id",v).eq("product_id",w);if(n)throw n;y(!0),setTimeout(()=>{N.push("/host/inventory/".concat(v))},1500)}catch(e){console.error("Error updating product:",e),b("Failed to update product"),f(!1)}};return m?(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("i",{className:"fas fa-spinner fa-spin text-2xl text-gray-500"})}):(0,s.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"Edit Product"}),(0,s.jsx)(c(),{href:"/host/inventory/".concat(v),children:(0,s.jsx)("span",{className:"text-blue-500 hover:underline cursor-pointer",children:"Back to Inventory"})})]}),g&&(0,s.jsx)("div",{className:"bg-red-100 text-red-700 p-3 rounded mb-4",children:g}),j&&(0,s.jsx)("div",{className:"bg-green-100 text-green-700 p-3 rounded mb-4",children:"Product updated successfully! Redirecting..."}),(0,s.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Barcode:"}),(0,s.jsx)("input",{type:"text",name:"barcode",value:e.barcode,onChange:k,className:"w-full border rounded px-3 py-2",placeholder:"Enter barcode"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Name:"}),(0,s.jsx)("input",{type:"text",name:"name",value:e.name,onChange:k,className:"w-full border rounded px-3 py-2",placeholder:"Product name",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Price (EUR):"}),(0,s.jsx)("input",{type:"number",step:"0.01",name:"price",value:e.price,onChange:k,className:"w-full border rounded px-3 py-2",placeholder:"0.00",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Quantity:"}),(0,s.jsx)("input",{type:"number",name:"quantity",value:e.quantity,onChange:k,className:"w-full border rounded px-3 py-2",placeholder:"1",min:"0",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Description:"}),(0,s.jsx)("textarea",{name:"description",value:e.description,onChange:k,className:"w-full border rounded px-3 py-2 h-24",placeholder:"Product description"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Category:"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("label",{className:"inline-flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"category",value:"Food and Drinks",checked:"Food and Drinks"===e.category,onChange:k,className:"mr-2",required:!0}),(0,s.jsx)("span",{children:"Food and Drinks"})]}),(0,s.jsxs)("label",{className:"inline-flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"category",value:"Articles",checked:"Articles"===e.category,onChange:k,className:"mr-2",required:!0}),(0,s.jsx)("span",{children:"Articles"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Image:"}),l&&(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsx)(o(),{src:l,alt:"Preview",width:128,height:128,className:"object-cover rounded border"})}),(0,s.jsx)("input",{type:"file",name:"image",onChange:k,accept:"image/*",className:"w-full border rounded px-3 py-2"})]}),(0,s.jsx)(x.Z,{cancelHref:"/host/inventory/".concat(v),submitText:"Save Changes",loading:p,loadingText:"Saving..."})]})]})}h.getLayout=function(e){return(0,s.jsx)(d.Z,{title:"Edit Product - Guestify",children:(0,s.jsx)(m.Z,{children:e})})}}},function(e){e.O(0,[61,888,774,179],function(){return e(e.s=1377)}),_N_E=e.O()}]);