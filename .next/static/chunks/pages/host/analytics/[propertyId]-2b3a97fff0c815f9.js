(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[944],{9440:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/host/analytics/[propertyId]",function(){return t(7131)}])},3013:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var a=t(5893),r=t(1664),l=t.n(r);function n(e){let{propertyId:s,activeTab:t,propertyName:r}=e;return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsx)(l(),{href:"/host/dashboard",children:(0,a.jsxs)("span",{className:"text-[#5e2bff] hover:underline flex items-center cursor-pointer",children:[(0,a.jsx)("i",{className:"fas fa-arrow-left mr-1"})," Back to Dashboard"]})})}),(0,a.jsxs)("h2",{className:"text-lg sm:text-2xl font-bold text-[#5e2bff] mb-4",children:["Property: ",r||""]}),(0,a.jsx)("div",{className:"flex flex-wrap justify-center items-center gap-2 mb-4",children:[{id:"analytics",label:"Analytics",href:"/host/analytics/".concat(s)},{id:"orders",label:"Orders",href:"/host/orders/".concat(s)},{id:"inventory",label:"Inventory",href:"/host/inventory/".concat(s)},{id:"printqr",label:"Print QR",href:"/host/printqr/".concat(s)}].map(e=>(0,a.jsx)(l(),{href:e.href,children:(0,a.jsx)("span",{className:"px-3 py-1 rounded text-sm hover:bg-gray-300 transition cursor-pointer ".concat(t===e.id?"bg-[#fad02f] text-black font-bold hover:opacity-90":"bg-gray-200"),children:e.label})},e.id))})]})}},430:function(e,s,t){"use strict";t.d(s,{Z:function(){return m}});var a=t(5893),r=t(9008),l=t.n(r),n=t(1664),i=t.n(n),o=t(5675),c=t.n(o);t(1163);var d=t(5482);function m(e){let{children:s,title:t="Guestify"}=e,{user:r,signOut:n}=(0,d.a)();return(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50 text-gray-800",children:[(0,a.jsxs)(l(),{children:[(0,a.jsx)("title",{children:t}),(0,a.jsx)("meta",{name:"description",content:"Guestify - Food service for Airbnb hosts"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)("header",{className:"bg-[#5e2bff] p-4 shadow-md rounded-b-xl",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center",children:r?(0,a.jsx)(i(),{href:"/host/dashboard",children:(0,a.jsx)("span",{className:"cursor-pointer",children:(0,a.jsx)(c(),{src:"/images/guestify_logo.png",alt:"Guestify",width:40,height:40,className:"h-10 w-auto"})})}):(0,a.jsx)("span",{children:(0,a.jsx)(c(),{src:"/images/guestify_logo.png",alt:"Guestify",width:40,height:40,className:"h-10 w-auto"})})}),(0,a.jsx)("nav",{className:"flex items-center",children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{href:"/host/dashboard",children:(0,a.jsx)("span",{className:"mx-1 sm:mx-2 text-white font-semibold hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Dashboard"})}),(0,a.jsx)("button",{onClick:n,className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base bg-transparent border-none cursor-pointer",children:"Logout"}),(0,a.jsx)(i(),{href:"/host/profile",children:(0,a.jsx)("span",{className:"ml-2 cursor-pointer",children:(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-white text-[#5e2bff] flex items-center justify-center",children:(0,a.jsx)("i",{className:"fas fa-smile"})})})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i(),{href:"/auth/signin",children:(0,a.jsx)("span",{className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Login"})}),(0,a.jsx)(i(),{href:"/auth/signup",children:(0,a.jsx)("span",{className:"mx-1 sm:mx-2 text-white hover:opacity-80 transition-colors text-sm sm:text-base cursor-pointer",children:"Signup"})})]})})]})}),(0,a.jsx)("main",{className:"max-w-6xl mx-auto my-4 p-2 sm:p-4 rounded-xl flex-grow w-full",children:s}),(0,a.jsx)("footer",{className:"bg-[#5e2bff] p-4 rounded-t-xl",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto text-center text-white text-sm",children:(0,a.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," Guestify"]})})})]})}},7131:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return p}});var a=t(5893),r=t(7294),l=t(1163),n=t(430),i=t(3013),o=t(5240),c=t(4715),d=t(398),m=t(7017),h=t(5615),x=t(8793),u=t(4570),f=t(8042),g=t(8807);function p(){let[e,s]=(0,r.useState)(""),[t,n]=(0,r.useState)([]),[p,j]=(0,r.useState)(0),[b,y]=(0,r.useState)(0),[N,w]=(0,r.useState)(0),[v,_]=(0,r.useState)(0),[S,F]=(0,r.useState)([]),[k,D]=(0,r.useState)(!0),[O,E]=(0,r.useState)(null),{propertyId:q}=(0,l.useRouter)().query;return(0,r.useEffect)(()=>{q&&e();async function e(){try{D(!0);let{data:e,error:t}=await o.O.from("apartments").select("name").eq("id",q).single();if(t)throw t;s(e.name);let{data:a,error:r}=await o.O.from("orders").select("*").eq("apartment_id",q);if(r)throw r;if(!a||0===a.length){n([]),j(0),y(0),w(0),_(0),D(!1);return}let l=a.map(e=>e.id),{data:i,error:c}=await o.O.from("order_items").select("order_id, product_id, quantity, price").in("order_id",l);if(c)throw c;let{data:d,error:m}=await o.O.from("products").select("id, name");if(m)throw m;let h={};d.forEach(e=>{h[e.id]=e.name});let x={};i.forEach(e=>{x[e.product_id]||(x[e.product_id]=0),x[e.product_id]+=e.quantity});let u=Object.keys(x).map(e=>({name:h[e]||"Unknown",totalSold:x[e]}));u.sort((e,s)=>s.totalSold-e.totalSold),n(u.slice(0,5));let f=0,g=0,p=0,b=new Date,N=b.getMonth(),v=b.getFullYear(),S={};a.forEach(e=>{let s=new Date(e.order_date),t=parseFloat(e.total_price);f+=t,s.getMonth()===N&&s.getFullYear()===v&&(g+=t,p++);let a="".concat(s.getFullYear(),"-").concat(s.getMonth()+1);S[a]||(S[a]={month:new Date(s.getFullYear(),s.getMonth(),1).toLocaleDateString("en-US",{month:"short",year:"numeric"}),sales:0,orders:0}),S[a].sales+=t,S[a].orders+=1});let k=Object.values(S);k.sort((e,s)=>{let t=new Date(e.month),a=new Date(s.month);return t-a}),j(g),y(p),w(f),_(a.length),F(k)}catch(e){console.error("Error fetching analytics:",e),E("Failed to load analytics data")}finally{D(!1)}}},[q]),(0,a.jsxs)("div",{children:[(0,a.jsx)(i.Z,{propertyId:q,activeTab:"analytics",propertyName:e}),k?(0,a.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):O?(0,a.jsx)("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-6",children:O}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Top Selling Products"}),t&&t.length>0?(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsxs)("li",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.name}),(0,a.jsxs)("span",{className:"text-sm font-medium bg-purple-100 text-purple-800 px-2 py-1 rounded",children:[e.totalSold," sold"]})]},s))}):(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"No data yet."})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Sales This Month"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-gray-800",children:["€",p.toFixed(2),(0,a.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",b," orders)"]})]}),(0,a.jsx)("div",{className:"mt-2 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"inline-block w-3 h-3 rounded-full ".concat(b>0?"bg-green-500":"bg-gray-300"," mr-2")}),(0,a.jsx)("span",{className:"text-gray-600",children:b>0?"Active this month":"No orders this month"})]})})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Total Sales"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-gray-800",children:["€",N.toFixed(2),(0,a.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",v," orders)"]})]}),(0,a.jsx)("div",{className:"mt-2 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"inline-block w-3 h-3 rounded-full ".concat(v>10?"bg-blue-500":"bg-yellow-500"," mr-2")}),(0,a.jsx)("span",{className:"text-gray-600",children:v>10?"Well established":"Growing business"})]})})]})]}),S.length>0&&(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-8",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Monthly Sales Overview"}),(0,a.jsx)("div",{className:"h-64 mt-4",children:(0,a.jsx)(c.h,{width:"100%",height:"100%",children:(0,a.jsxs)(d.v,{data:S,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(m.q,{strokeDasharray:"3 3"}),(0,a.jsx)(h.K,{dataKey:"month"}),(0,a.jsx)(x.B,{}),(0,a.jsx)(u.u,{formatter:e=>"€".concat(e.toFixed(2))}),(0,a.jsx)(f.D,{}),(0,a.jsx)(g.$,{dataKey:"sales",name:"Sales (€)",fill:"#8884d8"})]})})})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Performance Insights"}),v>0?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800",children:"Average Order Value"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["€",(N/v).toFixed(2)," per order"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800",children:"Recommendations"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-gray-600 space-y-1 text-sm",children:[t.length>0&&(0,a.jsxs)("li",{children:['Your top seller is "',t[0].name,'" - consider adding similar products']}),0===b&&(0,a.jsx)("li",{children:"No sales this month - consider running a promotion"}),b>0&&b<5&&(0,a.jsx)("li",{children:"Low sales volume this month - try advertising your menu to guests"})]})]})]}):(0,a.jsx)("p",{className:"text-gray-500",children:"Make your first sale to see performance insights."})]})]})]})}p.getLayout=function(e){return(0,a.jsx)(n.Z,{title:"Analytics - Guestify",children:e})}}},function(e){e.O(0,[61,894,888,774,179],function(){return e(e.s=9440)}),_N_E=e.O()}]);