"use strict";(()=>{var e={};e.id=899,e.ids=[899],e.modules={4001:e=>{e.exports=require("@supabase/auth-helpers-nextjs")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},1388:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>u,routeModule:()=>d});var s=t(1802),o=t(7153),n=t(6249),i=t(6963),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,n.l)(i,"default"),l=(0,n.l)(i,"config"),d=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/stripe/connect",pathname:"/api/stripe/connect",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},6963:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>handler});var s=t(6090),o=t(4001),n=e([s]);s=(n.then?(await n)():n)[0];let i=new s.default(process.env.STRIPE_SECRET_KEY);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let t=(0,o.createServerSupabaseClient)({req:e,res:r}),{data:{session:a}}=await t.auth.getSession();if(!a)return r.status(401).json({error:"Unauthorized"});try{let{userId:s}=e.body;if(s!==a.user.id)return r.status(403).json({error:"Forbidden"});let{data:o,error:n}=await t.from("profiles").select("stripe_account_id").eq("id",s).single();if(n&&"PGRST116"!==n.code)throw Error(n.message);let c=o?.stripe_account_id;if(!c){let e=await i.accounts.create({type:"express",email:a.user.email});c=e.id;let{error:r}=await t.from("profiles").update({stripe_account_id:c}).eq("id",s);if(r)throw Error(r.message)}let u=await i.accountLinks.create({account:c,refresh_url:`${process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:3000"}/host/connect-stripe`,return_url:`${process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:3000"}/host/dashboard`,type:"account_onboarding"});return r.status(200).json({url:u.url})}catch(e){return console.error("Error in Stripe connect:",e),r.status(500).json({error:e.message||"Internal server error"})}}a()}catch(e){a(e)}})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222],()=>__webpack_exec__(1388));module.exports=t})();