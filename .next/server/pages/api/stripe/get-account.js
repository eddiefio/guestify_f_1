"use strict";(()=>{var e={};e.id=361,e.ids=[361],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},4821:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>p});var s=r(1802),n=r(7153),a=r(6249),i=r(7784),c=e([i]);i=(c.then?(await c)():c)[0];let u=(0,a.l)(i,"default"),l=(0,a.l)(i,"config"),p=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/stripe/get-account",pathname:"/api/stripe/get-account",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},8456:(e,t,r)=>{r.d(t,{OQ:()=>a});var o=r(2885);let s=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://ndiqnzxplopcbcxzondp.supabase.co",n=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kaXFuenhwbG9wY2JjeHpvbmRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1NDkxODQsImV4cCI6MjA1NTEyNTE4NH0.jCnn7TFfGV1EpBHhO1ITa8PMytD7UJfADpuzrzZOgpw",a=(0,o.createClient)(s,n,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storageKey:"supabase-auth",storage:{getItem:e=>null,setItem:(e,t)=>{},removeItem:e=>{}},cookieOptions:{secure:!0,sameSite:"lax",path:"/"}},global:{headers:{"Cache-Control":"no-store, no-cache, must-revalidate"}}})},7784:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>i});var s=r(6090),n=r(8456),a=e([s]);async function i(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{userId:r}=e.body;if(!r)return t.status(400).json({error:"User ID is required"});try{console.log("Getting Stripe account for user:",r);let e=process.env.STRIPE_SECRET_KEY;if(!e)return t.status(500).json({error:"Stripe secret key not configured"});let o=new s.default(e),{data:a,error:i}=await n.OQ.from("profiles").select("stripe_account_id").eq("id",r).single();if(i&&"PGRST116"!==i.code)return console.error("Error fetching profile:",i),t.status(500).json({error:"Failed to fetch user profile"});if(a&&a.stripe_account_id)return console.log("User already has Stripe account ID:",a.stripe_account_id),t.status(200).json({stripeAccountId:a.stripe_account_id});let c=global.tempStripeAccounts?.[r];if(c)return console.log("Found temporary Stripe account ID:",c),t.status(200).json({stripeAccountId:c});let{data:u,error:l}=await n.OQ.auth.admin.getUserById(r);if(l)return console.error("Error fetching user:",l),t.status(500).json({error:"Failed to fetch user details"});let p=u?.user?.email;if(!p)return t.status(400).json({error:"User email not found"});let d=await o.accounts.create({type:"express",email:p,capabilities:{card_payments:{requested:!0},transfers:{requested:!0}}});return console.log("Created new Stripe account:",d.id),global.tempStripeAccounts=global.tempStripeAccounts||{},global.tempStripeAccounts[r]=d.id,t.status(200).json({stripeAccountId:d.id})}catch(e){return console.error("Error in get-account handler:",e),t.status(500).json({error:e.message||"Failed to retrieve Stripe account"})}}s=(a.then?(await a)():a)[0],o()}catch(e){o(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=4821);module.exports=r})();