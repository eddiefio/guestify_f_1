"use strict";(()=>{var e={};e.id=756,e.ids=[756],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},3555:(e,t,r)=>{r.r(t),r.d(t,{config:()=>P,default:()=>c,routeModule:()=>g});var n={};r.r(n),r.d(n,{default:()=>p});var i=r(1802),a=r(7153),o=r(6249);let s=require("@supabase/auth-helpers-nextjs"),u=require("pdfkit");var d=r.n(u);let f=require("qrcode");var l=r.n(f);async function p(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let r=(0,s.createServerSupabaseClient)({req:e,res:t}),{propertyId:n}=e.query,{data:{session:i},error:a}=await r.auth.getSession();if(a||!i)return t.status(401).json({error:"Unauthorized"});let{data:o,error:u}=await r.from("apartments").select("id, host_id, name, address, city").eq("id",n).single();if(u||!o)return t.status(404).json({error:"Property not found"});if(o.host_id!==i.user.id)return t.status(403).json({error:"Access denied"});let f=process.env.NEXT_PUBLIC_BASE_URL||"https://app.guestify.shop",p=`${f}/guest/menu/${n}`,c=await l().toDataURL(p,{width:300,margin:1,color:{dark:"#5e2bff",light:"#ffffff"}});t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition","attachment; filename=guestify-qrcode.pdf");let P=new(d())({size:"A4",margin:50});P.pipe(t),P.fontSize(24).text("Guestify Menu",{align:"center"}),P.fontSize(18).text(o.name,{align:"center"});let g=Buffer.from(c.split(",")[1],"base64");P.image(g,{fit:[300,300],align:"center",valign:"center"}),P.fontSize(12).text("Scan this QR code to access the menu",{align:"center"}),P.fontSize(10).text(p,{align:"center",color:"blue"}),P.end()}catch(e){return console.error("Error:",e),t.status(500).json({error:"Internal server error"})}}let c=(0,o.l)(n,"default"),P=(0,o.l)(n,"config"),g=new i.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/printqr-pdf",pathname:"/api/printqr-pdf",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=3555);module.exports=r})();