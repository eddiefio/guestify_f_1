"use strict";(()=>{var e={};e.id=962,e.ids=[962,888,660],e.modules={8742:(e,t,r)=>{r.r(t),r.d(t,{config:()=>N,default:()=>w,getServerSideProps:()=>S,getStaticPaths:()=>P,getStaticProps:()=>v,reportWebVitals:()=>_,routeModule:()=>F,unstable_getServerProps:()=>k,unstable_getServerSideProps:()=>D,unstable_getStaticParams:()=>Q,unstable_getStaticPaths:()=>q,unstable_getStaticProps:()=>R});var s={};r.r(s),r.d(s,{default:()=>PrintQR});var a=r(7093),i=r(5244),n=r(1323),l=r(9209),o=r.n(l),d=r(9597),c=r(997),u=r(6689),p=r(1163),m=r(5675),f=r.n(m);r(1664);var x=r(9430),h=r(5240),g=r(4478);let b=require("qrcode");var y=r.n(b),j=r(7016);function PrintQR(){let[e,t]=(0,u.useState)(""),[r,s]=(0,u.useState)(""),[a,i]=(0,u.useState)(""),[n,l]=(0,u.useState)(!0),[o,d]=(0,u.useState)(null),[m,x]=(0,u.useState)("idle"),[b,w]=(0,u.useState)(""),v=(0,u.useRef)(null),P=(0,p.useRouter)(),{propertyId:S}=P.query,{user:N,profile:_}=(0,j.a)();(0,u.useEffect)(()=>{if(S&&N){if(!_?.stripe_account_id){P.push("/host/connect-stripe");return}fetchData()}async function fetchData(){try{l(!0);let{data:e,error:r}=await g.O.from("apartments").select("name").eq("id",S).single();if(r)throw r;t(e.name);let a=window.location.origin,n=`${a}/guest/menu/${S}`;i(n);let o=await y().toDataURL(n,{width:400,margin:1,color:{dark:"#5e2bff",light:"#ffffff"}});s(o)}catch(e){console.error("Error generating QR code:",e),d("Failed to generate QR code")}finally{l(!1)}}},[S,N,_,P]);let handlePrintQR=async()=>{try{x("preparing");let e=await fetch(`/api/printqr-pdf?propertyId=${S}`,{method:"GET"});if(!e.ok)throw Error("Failed to generate PDF");let t=await e.blob(),r=URL.createObjectURL(t);w(r),x("ready"),window.open(r,"_blank")}catch(e){console.error("Error creating PDF:",e),x("error")}};return(0,c.jsxs)("div",{children:[c.jsx(h.Z,{propertyId:S,activeTab:"printqr",propertyName:e}),n?c.jsx("div",{className:"flex justify-center items-center py-12",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):o?c.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-6",children:o}):(0,c.jsxs)("div",{className:"max-w-md mx-auto text-center bg-white p-6 rounded-lg shadow-md",children:[c.jsx("h3",{className:"text-xl font-semibold mb-6",children:"Menu QR Code"}),c.jsx("p",{className:"mb-6 text-gray-600",children:"Place this QR code in your rental property so guests can easily access your menu."}),c.jsx("div",{className:"mb-6 border p-4 rounded-lg bg-gray-50 mx-auto",style:{maxWidth:"280px"},ref:v,children:r&&(0,c.jsxs)("div",{children:[c.jsx("div",{className:"text-[#5e2bff] font-bold text-lg mb-2",children:"Guestify Menu"}),c.jsx("div",{className:"mb-4 mx-auto",style:{width:"200px",height:"200px",position:"relative"},children:c.jsx(f(),{src:r,alt:"QR Code",layout:"fill",objectFit:"contain"})}),c.jsx("div",{className:"text-sm text-gray-500 mt-2",children:e})]})}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center gap-4 mb-6",children:[(0,c.jsxs)("button",{onClick:()=>{if(v.current){let t=window.open("","","height=500,width=500");t.document.write("<html><head><title>Print QR Code</title>"),t.document.write("</head><body>"),t.document.write('<div style="text-align:center; padding:20px;">'),t.document.write('<h1 style="font-family:Arial,sans-serif;color:#5e2bff;">Guestify Menu</h1>'),t.document.write('<h2 style="font-family:Arial,sans-serif;color:#333;">'+e+"</h2>"),t.document.write('<div style="margin:30px 0;">'),t.document.write('<img src="'+r+'" style="width:300px;height:300px;" />'),t.document.write("</div>"),t.document.write('<p style="font-family:Arial,sans-serif;color:#666;">Scan this QR code to access the menu</p>'),t.document.write('<p style="font-family:Arial,sans-serif;color:#999;font-size:12px;">'+a+"</p>"),t.document.write("</div>"),t.document.write("</body></html>"),t.document.close(),t.focus(),setTimeout(()=>{t.print()},250)}},className:"bg-white border border-[#5e2bff] text-[#5e2bff] px-4 py-2 rounded-full hover:bg-purple-50 transition-colors flex items-center justify-center",children:[c.jsx("i",{className:"fas fa-print mr-2"}),"Print Directly"]}),c.jsx("button",{onClick:handlePrintQR,disabled:"preparing"===m,className:"bg-[#fad02f] text-black px-4 py-2 rounded-full hover:opacity-90 transition font-semibold flex items-center justify-center",children:"preparing"===m?(0,c.jsxs)(c.Fragment,{children:[c.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Preparing PDF..."]}):(0,c.jsxs)(c.Fragment,{children:[c.jsx("i",{className:"fas fa-file-pdf mr-2"}),"Download PDF"]})})]}),"ready"===m&&b&&(0,c.jsxs)("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[c.jsx("p",{className:"text-sm text-green-700 mb-2",children:"PDF generated successfully!"}),c.jsx("a",{href:b,download:"guestify-qrcode.pdf",className:"text-[#5e2bff] hover:underline text-sm",children:"Click here to download if it didn't open automatically"})]}),"error"===m&&c.jsx("div",{className:"mt-4 p-3 bg-red-50 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-700",children:"There was an error generating the PDF. Please try again."})}),(0,c.jsxs)("div",{className:"mt-6",children:[c.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Or share this URL with your guests:"}),(0,c.jsxs)("div",{className:"flex items-center justify-center",children:[c.jsx("input",{type:"text",value:a,readOnly:!0,className:"w-full text-sm text-gray-700 border rounded-l px-3 py-2 bg-gray-50"}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(a),alert("URL copied to clipboard!")},className:"bg-gray-200 px-3 py-2 rounded-r hover:bg-gray-300 transition-colors",title:"Copy to clipboard",children:c.jsx("i",{className:"fas fa-copy"})})]})]})]})]})}PrintQR.getLayout=function(e){return c.jsx(x.Z,{title:"Print QR Code - Guestify",children:e})};let w=(0,n.l)(s,"default"),v=(0,n.l)(s,"getStaticProps"),P=(0,n.l)(s,"getStaticPaths"),S=(0,n.l)(s,"getServerSideProps"),N=(0,n.l)(s,"config"),_=(0,n.l)(s,"reportWebVitals"),R=(0,n.l)(s,"unstable_getStaticProps"),q=(0,n.l)(s,"unstable_getStaticPaths"),Q=(0,n.l)(s,"unstable_getStaticParams"),k=(0,n.l)(s,"unstable_getServerProps"),D=(0,n.l)(s,"unstable_getServerSideProps"),F=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/host/printqr/[propertyId]",pathname:"/host/printqr/[propertyId]",bundlePath:"",filename:""},components:{App:d.default,Document:o()},userland:s})},2885:e=>{e.exports=require("@supabase/supabase-js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[761,163,209,450,664,201,675,597,430,240],()=>__webpack_exec__(8742));module.exports=r})();