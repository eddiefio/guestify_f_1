"use strict";(()=>{var e={};e.id=944,e.ids=[944,888,660],e.modules={5535:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>g,default:()=>m,getServerSideProps:()=>p,getStaticPaths:()=>u,getStaticProps:()=>h,reportWebVitals:()=>y,routeModule:()=>N,unstable_getServerProps:()=>q,unstable_getServerSideProps:()=>v,unstable_getStaticParams:()=>f,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>b});var a=s(7093),l=s(5244),i=s(1323),o=s(9209),d=s.n(o),n=s(9597),c=s(8280),x=e([c]);c=(x.then?(await x)():x)[0];let m=(0,i.l)(c,"default"),h=(0,i.l)(c,"getStaticProps"),u=(0,i.l)(c,"getStaticPaths"),p=(0,i.l)(c,"getServerSideProps"),g=(0,i.l)(c,"config"),y=(0,i.l)(c,"reportWebVitals"),b=(0,i.l)(c,"unstable_getStaticProps"),j=(0,i.l)(c,"unstable_getStaticPaths"),f=(0,i.l)(c,"unstable_getStaticParams"),q=(0,i.l)(c,"unstable_getServerProps"),v=(0,i.l)(c,"unstable_getServerSideProps"),N=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/host/analytics/[propertyId]",pathname:"/host/analytics/[propertyId]",bundlePath:"",filename:""},components:{App:n.default,Document:d()},userland:c});r()}catch(e){r(e)}})},8280:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>Analytics});var a=s(997),l=s(6689),i=s(1163),o=s(9430),d=s(5240),n=s(4478),c=s(9009),x=s(4831),m=s(4195),h=s(3023),u=s(5358),p=s(4279),g=s(1460),y=s(7226),b=e([c,x,m,h,u,p,g,y]);function Analytics(){let[e,t]=(0,l.useState)(""),[s,r]=(0,l.useState)([]),[o,b]=(0,l.useState)(0),[j,f]=(0,l.useState)(0),[q,v]=(0,l.useState)(0),[N,S]=(0,l.useState)(0),[w,_]=(0,l.useState)([]),[P,F]=(0,l.useState)(!0),[k,A]=(0,l.useState)(null),M=(0,i.useRouter)(),{propertyId:O}=M.query;return(0,l.useEffect)(()=>{O&&fetchAnalytics();async function fetchAnalytics(){try{F(!0);let{data:e,error:s}=await n.O.from("apartments").select("name").eq("id",O).single();if(s)throw s;t(e.name);let{data:a,error:l}=await n.O.from("orders").select("*").eq("apartment_id",O);if(l)throw l;if(!a||0===a.length){r([]),b(0),f(0),v(0),S(0),F(!1);return}let i=a.map(e=>e.id),{data:o,error:d}=await n.O.from("order_items").select("order_id, product_id, quantity, price").in("order_id",i);if(d)throw d;let{data:c,error:x}=await n.O.from("products").select("id, name");if(x)throw x;let m={};c.forEach(e=>{m[e.id]=e.name});let h={};o.forEach(e=>{h[e.product_id]||(h[e.product_id]=0),h[e.product_id]+=e.quantity});let u=Object.keys(h).map(e=>({name:m[e]||"Unknown",totalSold:h[e]}));u.sort((e,t)=>t.totalSold-e.totalSold),r(u.slice(0,5));let p=0,g=0,y=0,j=new Date,q=j.getMonth(),N=j.getFullYear(),w={};a.forEach(e=>{let t=new Date(e.order_date),s=parseFloat(e.total_price);p+=s,t.getMonth()===q&&t.getFullYear()===N&&(g+=s,y++);let r=`${t.getFullYear()}-${t.getMonth()+1}`;w[r]||(w[r]={month:new Date(t.getFullYear(),t.getMonth(),1).toLocaleDateString("en-US",{month:"short",year:"numeric"}),sales:0,orders:0}),w[r].sales+=s,w[r].orders+=1});let P=Object.values(w);P.sort((e,t)=>{let s=new Date(e.month),r=new Date(t.month);return s-r}),b(g),f(y),v(p),S(a.length),_(P)}catch(e){console.error("Error fetching analytics:",e),A("Failed to load analytics data")}finally{F(!1)}}},[O]),(0,a.jsxs)("div",{children:[a.jsx(d.Z,{propertyId:O,activeTab:"analytics",propertyName:e}),P?a.jsx("div",{className:"flex justify-center items-center py-12",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):k?a.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-6",children:k}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[a.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Top Selling Products"}),s&&s.length>0?a.jsx("ul",{className:"space-y-2",children:s.map((e,t)=>(0,a.jsxs)("li",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-700",children:e.name}),(0,a.jsxs)("span",{className:"text-sm font-medium bg-purple-100 text-purple-800 px-2 py-1 rounded",children:[e.totalSold," sold"]})]},t))}):a.jsx("p",{className:"text-gray-500 text-sm",children:"No data yet."})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[a.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Sales This Month"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-gray-800",children:["€",o.toFixed(2),(0,a.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",j," orders)"]})]}),a.jsx("div",{className:"mt-2 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${j>0?"bg-green-500":"bg-gray-300"} mr-2`}),a.jsx("span",{className:"text-gray-600",children:j>0?"Active this month":"No orders this month"})]})})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[a.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Total Sales"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-gray-800",children:["€",q.toFixed(2),(0,a.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",N," orders)"]})]}),a.jsx("div",{className:"mt-2 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("span",{className:`inline-block w-3 h-3 rounded-full ${N>10?"bg-blue-500":"bg-yellow-500"} mr-2`}),a.jsx("span",{className:"text-gray-600",children:N>10?"Well established":"Growing business"})]})})]})]}),w.length>0&&(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-8",children:[a.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Monthly Sales Overview"}),a.jsx("div",{className:"h-64 mt-4",children:a.jsx(c.h,{width:"100%",height:"100%",children:(0,a.jsxs)(x.v,{data:w,margin:{top:5,right:30,left:20,bottom:5},children:[a.jsx(m.q,{strokeDasharray:"3 3"}),a.jsx(h.K,{dataKey:"month"}),a.jsx(u.B,{}),a.jsx(p.u,{formatter:e=>`€${e.toFixed(2)}`}),a.jsx(g.D,{}),a.jsx(y.$,{dataKey:"sales",name:"Sales (€)",fill:"#8884d8"})]})})})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[a.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-800 mb-3",children:"Performance Insights"}),N>0?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-gray-800",children:"Average Order Value"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["€",(q/N).toFixed(2)," per order"]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"font-medium text-gray-800",children:"Recommendations"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-gray-600 space-y-1 text-sm",children:[s.length>0&&(0,a.jsxs)("li",{children:['Your top seller is "',s[0].name,'" - consider adding similar products']}),0===j&&a.jsx("li",{children:"No sales this month - consider running a promotion"}),j>0&&j<5&&a.jsx("li",{children:"Low sales volume this month - try advertising your menu to guests"})]})]})]}):a.jsx("p",{className:"text-gray-500",children:"Make your first sale to see performance insights."})]})]})]})}[c,x,m,h,u,p,g,y]=b.then?(await b)():b,Analytics.getLayout=function(e){return a.jsx(o.Z,{title:"Analytics - Guestify",children:e})},r()}catch(e){r(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},5502:e=>{e.exports=require("eventemitter3")},8759:e=>{e.exports=require("lodash/every")},6918:e=>{e.exports=require("lodash/find")},8190:e=>{e.exports=require("lodash/flatMap")},1712:e=>{e.exports=require("lodash/get")},2327:e=>{e.exports=require("lodash/isBoolean")},113:e=>{e.exports=require("lodash/isEqual")},5716:e=>{e.exports=require("lodash/isFunction")},8843:e=>{e.exports=require("lodash/isNaN")},6069:e=>{e.exports=require("lodash/isNil")},7078:e=>{e.exports=require("lodash/isNumber")},5795:e=>{e.exports=require("lodash/isObject")},5452:e=>{e.exports=require("lodash/isPlainObject")},7026:e=>{e.exports=require("lodash/isString")},3824:e=>{e.exports=require("lodash/last")},9941:e=>{e.exports=require("lodash/mapValues")},6625:e=>{e.exports=require("lodash/max")},541:e=>{e.exports=require("lodash/memoize")},604:e=>{e.exports=require("lodash/min")},4042:e=>{e.exports=require("lodash/range")},4129:e=>{e.exports=require("lodash/some")},3672:e=>{e.exports=require("lodash/sortBy")},1381:e=>{e.exports=require("lodash/throttle")},9309:e=>{e.exports=require("lodash/uniqBy")},5428:e=>{e.exports=require("lodash/upperFirst")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},1469:e=>{e.exports=require("react-is")},3522:e=>{e.exports=require("react-smooth")},997:e=>{e.exports=require("react/jsx-runtime")},9540:e=>{e.exports=require("recharts-scale")},8970:e=>{e.exports=require("victory-vendor/d3-scale")},2725:e=>{e.exports=require("victory-vendor/d3-shape")},6593:e=>{e.exports=import("clsx")},4281:e=>{e.exports=import("tiny-invariant")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[761,163,209,450,664,201,675,8,597,430,240],()=>__webpack_exec__(5535));module.exports=s})();