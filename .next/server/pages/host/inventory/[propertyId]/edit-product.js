"use strict";(()=>{var e={};e.id=9,e.ids=[9,888,660],e.modules={4305:(e,t,r)=>{r.r(t),r.d(t,{config:()=>v,default:()=>x,getServerSideProps:()=>j,getStaticPaths:()=>y,getStaticProps:()=>f,reportWebVitals:()=>N,routeModule:()=>q,unstable_getServerProps:()=>P,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>O,unstable_getStaticPaths:()=>w,unstable_getStaticProps:()=>_});var a={};r.r(a),r.d(a,{default:()=>EditProduct});var n=r(7093),o=r(5244),s=r(1323),i=r(9209),l=r.n(i),d=r(9597),c=r(997),u=r(6689),p=r(1163),m=r(1664),h=r.n(m),b=r(5675),g=r.n(b);function EditProduct(){let[e,t]=(0,u.useState)({barcode:"",name:"",price:"",quantity:"",description:"",category:"",image_url:""}),[r,a]=(0,u.useState)(null),[n,o]=(0,u.useState)(""),[s,i]=(0,u.useState)(!0),[l,d]=(0,u.useState)(!1),[m,b]=(0,u.useState)(null),[x,f]=(0,u.useState)(!1),y=(0,p.useRouter)(),{propertyId:j,productId:v}=y.query;(0,u.useEffect)(()=>{j&&v&&fetchProduct();async function fetchProduct(){try{i(!0);let{data:e,error:r}=await Object(function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}()).from("products").select("*").eq("id",v).single();if(r)throw r;let{data:a,error:n}=await Object(function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}()).from("inventory").select("*").eq("apartment_id",j).eq("product_id",v).single();if(n)throw n;t({barcode:e.barcode||"",name:e.name||"",price:a.price||"",quantity:a.quantity||"",description:e.description||"",category:e.category||"Food and Drinks",image_url:e.image_url||""}),e.image_url&&o(e.image_url)}catch(e){console.error("Error fetching product:",e),b("Failed to load product data")}finally{i(!1)}}},[j,v]);let handleChange=e=>{let{name:r,value:n,type:s}=e.target;if("file"===s){let t=e.target.files[0];if(a(t),t){let e=URL.createObjectURL(t);return o(e),()=>URL.revokeObjectURL(e)}}else t(e=>({...e,[r]:n}))},handleSubmit=async t=>{t.preventDefault(),d(!0),b(null);try{let t=e.image_url;if(r){let e=r.name.split(".").pop(),a=`${Math.random().toString(36).substring(2,15)}.${e}`,n=`product-images/${a}`,{error:o}=await Object(function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}()).storage.from("guestify").upload(n,r);if(o)throw o;let{data:s}=Object(function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}()).storage.from("guestify").getPublicUrl(n);t=s.publicUrl}let{error:a}=await Object(function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}()).from("products").update({barcode:e.barcode,name:e.name,description:e.description,category:e.category,image_url:t}).eq("id",v);if(a)throw a;let{error:n}=await Object(function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}()).from("inventory").update({quantity:parseInt(e.quantity),price:parseFloat(e.price)}).eq("apartment_id",j).eq("product_id",v);if(n)throw n;f(!0),setTimeout(()=>{y.push(`/host/inventory/${j}`)},1500)}catch(e){console.error("Error updating product:",e),b("Failed to update product"),d(!1)}};return s?c.jsx("div",{className:"text-center py-8",children:c.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-gray-500"})}):(0,c.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md",children:[(0,c.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[c.jsx("h2",{className:"text-xl font-bold",children:"Edit Product"}),c.jsx(h(),{href:`/host/inventory/${j}`,children:c.jsx("span",{className:"text-blue-500 hover:underline cursor-pointer",children:"Back to Inventory"})})]}),m&&c.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded mb-4",children:m}),x&&c.jsx("div",{className:"bg-green-100 text-green-700 p-3 rounded mb-4",children:"Product updated successfully! Redirecting..."}),(0,c.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Barcode:"}),c.jsx("input",{type:"text",name:"barcode",value:e.barcode,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"Enter barcode"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Name:"}),c.jsx("input",{type:"text",name:"name",value:e.name,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"Product name",required:!0})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Price (EUR):"}),c.jsx("input",{type:"number",step:"0.01",name:"price",value:e.price,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"0.00",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Quantity:"}),c.jsx("input",{type:"number",name:"quantity",value:e.quantity,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"1",min:"0",required:!0})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Description:"}),c.jsx("textarea",{name:"description",value:e.description,onChange:handleChange,className:"w-full border rounded px-3 py-2 h-24",placeholder:"Product description"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Category:"}),(0,c.jsxs)("div",{className:"flex space-x-4",children:[(0,c.jsxs)("label",{className:"inline-flex items-center",children:[c.jsx("input",{type:"radio",name:"category",value:"Food and Drinks",checked:"Food and Drinks"===e.category,onChange:handleChange,className:"mr-2",required:!0}),c.jsx("span",{children:"Food and Drinks"})]}),(0,c.jsxs)("label",{className:"inline-flex items-center",children:[c.jsx("input",{type:"radio",name:"category",value:"Articles",checked:"Articles"===e.category,onChange:handleChange,className:"mr-2",required:!0}),c.jsx("span",{children:"Articles"})]})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Image:"}),n&&c.jsx("div",{className:"mb-2",children:c.jsx(g(),{src:n,alt:"Preview",width:128,height:128,className:"object-cover rounded border"})}),c.jsx("input",{type:"file",name:"image",onChange:handleChange,accept:"image/*",className:"w-full border rounded px-3 py-2"})]}),(0,c.jsxs)("div",{className:"flex justify-between pt-4",children:[c.jsx(h(),{href:`/host/inventory/${j}`,children:c.jsx("span",{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition cursor-pointer",children:"Cancel"})}),c.jsx("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-[#fad02f] text-black rounded hover:opacity-90 transition font-semibold",children:l?"Saving...":"Save Changes"})]})]})]})}(function(){var e=Error("Cannot find module '../../../../../components/layout/Layout'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '../../../../../lib/supabase'");throw e.code="MODULE_NOT_FOUND",e}(),EditProduct.getLayout=function(e){return c.jsx(Object(function(){var e=Error("Cannot find module '../../../../../components/layout/Layout'");throw e.code="MODULE_NOT_FOUND",e}()),{title:"Edit Product - Guestify",children:e})};let x=(0,s.l)(a,"default"),f=(0,s.l)(a,"getStaticProps"),y=(0,s.l)(a,"getStaticPaths"),j=(0,s.l)(a,"getServerSideProps"),v=(0,s.l)(a,"config"),N=(0,s.l)(a,"reportWebVitals"),_=(0,s.l)(a,"unstable_getStaticProps"),w=(0,s.l)(a,"unstable_getStaticPaths"),O=(0,s.l)(a,"unstable_getStaticParams"),P=(0,s.l)(a,"unstable_getServerProps"),S=(0,s.l)(a,"unstable_getServerSideProps"),q=new n.PagesRouteModule({definition:{kind:o.x.PAGES,page:"/host/inventory/[propertyId]/edit-product",pathname:"/host/inventory/[propertyId]/edit-product",bundlePath:"",filename:""},components:{App:d.default,Document:l()},userland:a})},2885:e=>{e.exports=require("@supabase/supabase-js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[761,163,209,450,664,201,675,597],()=>__webpack_exec__(4305));module.exports=r})();