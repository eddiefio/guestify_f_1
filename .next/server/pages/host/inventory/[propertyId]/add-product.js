"use strict";(()=>{var e={};e.id=741,e.ids=[741,888,660],e.modules={3698:(e,t,r)=>{r.r(t),r.d(t,{config:()=>v,default:()=>x,getServerSideProps:()=>j,getStaticPaths:()=>f,getStaticProps:()=>y,reportWebVitals:()=>w,routeModule:()=>k,unstable_getServerProps:()=>q,unstable_getServerSideProps:()=>_,unstable_getStaticParams:()=>P,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>N});var a={};r.r(a),r.d(a,{default:()=>AddProduct});var s=r(7093),i=r(5244),n=r(1323),d=r(9209),l=r.n(d),o=r(9597),c=r(997),u=r(6689),m=r(1163),p=r(1664),h=r.n(p),b=r(9430),g=r(4478);function AddProduct(){let[e,t]=(0,u.useState)({barcode:"",name:"",price:"",quantity:"1",description:"",category:"Food and Drinks",image_url:""}),[r,a]=(0,u.useState)(null),[s,i]=(0,u.useState)(""),[n,d]=(0,u.useState)(!1),[l,o]=(0,u.useState)(!1),[p,b]=(0,u.useState)(null),[x,y]=(0,u.useState)(!1),f=(0,m.useRouter)(),{propertyId:j}=f.query;(0,u.useEffect)(()=>{f.query.barcode&&fetchProductByBarcode(f.query.barcode)},[f.query]);let fetchProductByBarcode=async r=>{try{d(!0);let{data:a,error:s}=await g.O.from("products").select("*").eq("barcode",r).single();if(s&&"PGRST116"!==s.code)throw s;a?(t({...e,barcode:a.barcode||"",name:a.name||"",description:a.description||"",category:a.category||"Food and Drinks",image_url:a.image_url||""}),a.image_url&&i(a.image_url)):t({...e,barcode:r})}catch(e){console.error("Error fetching product by barcode:",e),b("Failed to fetch product information")}finally{d(!1)}},handleChange=e=>{let{name:r,value:s,type:n}=e.target;if("file"===n){let t=e.target.files[0];if(a(t),t){let e=URL.createObjectURL(t);return i(e),()=>URL.revokeObjectURL(e)}}else t(e=>({...e,[r]:s}))},handleSubmit=async t=>{t.preventDefault(),d(!0),b(null);try{let t,a=e.image_url;if(r){let e=r.name.split(".").pop(),t=`${Math.random().toString(36).substring(2,15)}.${e}`,s=`product-images/${t}`,{error:i}=await g.O.storage.from("guestify").upload(s,r);if(i)throw i;let{data:n}=g.O.storage.from("guestify").getPublicUrl(s);a=n.publicUrl}let{data:s,error:i}=await g.O.from("products").select("id").eq("barcode",e.barcode).maybeSingle();if(i&&"PGRST116"!==i.code)throw i;if(s){let{data:r,error:i}=await g.O.from("products").update({name:e.name,description:e.description,category:e.category,image_url:a}).eq("id",s.id).select().single();if(i)throw i;t=r.id}else{let{data:r,error:s}=await g.O.from("products").insert([{barcode:e.barcode,name:e.name,description:e.description,category:e.category,image_url:a}]).select().single();if(s)throw s;t=r.id}let{data:n,error:d}=await g.O.from("inventory").select("id").eq("apartment_id",j).eq("product_id",t).maybeSingle();if(d&&"PGRST116"!==d.code)throw d;if(n){let{error:t}=await g.O.from("inventory").update({quantity:parseInt(e.quantity),price:parseFloat(e.price)}).eq("id",n.id);if(t)throw t}else{let{error:r}=await g.O.from("inventory").insert([{apartment_id:j,product_id:t,quantity:parseInt(e.quantity),price:parseFloat(e.price)}]);if(r)throw r}y(!0),setTimeout(()=>{f.push(`/host/inventory/${j}`)},1500)}catch(e){console.error("Error adding product:",e),b("Failed to add product"),d(!1)}};return(0,c.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md",children:[(0,c.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[c.jsx("h2",{className:"text-xl font-bold",children:"Add Product"}),c.jsx(h(),{href:`/host/inventory/${j}`,children:c.jsx("span",{className:"text-blue-500 hover:underline cursor-pointer",children:"Back to Inventory"})})]}),p&&c.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded mb-4",children:p}),x&&c.jsx("div",{className:"bg-green-100 text-green-700 p-3 rounded mb-4",children:"Product added successfully! Redirecting..."}),(0,c.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Barcode:"}),c.jsx("button",{type:"button",onClick:l?()=>{o(!1)}:()=>{o(!0)},className:"bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition",children:l?"Stop Scanning":"Scan Barcode"})]}),c.jsx("input",{type:"text",name:"barcode",value:e.barcode,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"Enter or scan barcode"})]}),l&&(0,c.jsxs)("div",{className:"mb-4 bg-black text-center p-4 rounded relative",children:[c.jsx("div",{className:"text-white mb-2",children:"Point camera at barcode"}),c.jsx("div",{className:"bg-white w-full h-40 flex items-center justify-center",children:c.jsx("span",{className:"text-gray-500",children:"Camera preview would appear here"})}),c.jsx("div",{className:"border-2 border-white absolute inset-0 m-8 pointer-events-none"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Name:"}),c.jsx("input",{type:"text",name:"name",value:e.name,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"Product name",required:!0})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Price (EUR):"}),c.jsx("input",{type:"number",step:"0.01",name:"price",value:e.price,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"0.00",required:!0})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Quantity:"}),c.jsx("input",{type:"number",name:"quantity",value:e.quantity,onChange:handleChange,className:"w-full border rounded px-3 py-2",placeholder:"1",min:"1",required:!0})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Description:"}),c.jsx("textarea",{name:"description",value:e.description,onChange:handleChange,className:"w-full border rounded px-3 py-2 h-24",placeholder:"Product description"})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Category:"}),(0,c.jsxs)("div",{className:"flex space-x-4",children:[(0,c.jsxs)("label",{className:"inline-flex items-center",children:[c.jsx("input",{type:"radio",name:"category",value:"Food and Drinks",checked:"Food and Drinks"===e.category,onChange:handleChange,className:"mr-2",required:!0}),c.jsx("span",{children:"Food and Drinks"})]}),(0,c.jsxs)("label",{className:"inline-flex items-center",children:[c.jsx("input",{type:"radio",name:"category",value:"Articles",checked:"Articles"===e.category,onChange:handleChange,className:"mr-2",required:!0}),c.jsx("span",{children:"Articles"})]})]})]}),(0,c.jsxs)("div",{children:[c.jsx("label",{className:"block text-gray-700 mb-1 font-medium",children:"Product Image:"}),s&&c.jsx("div",{className:"mb-2",children:c.jsx("img",{src:s,alt:"Preview",className:"w-32 h-32 object-cover rounded border"})}),c.jsx("input",{type:"file",name:"image",onChange:handleChange,accept:"image/*",className:"w-full border rounded px-3 py-2"})]}),(0,c.jsxs)("div",{className:"flex justify-between pt-4",children:[c.jsx(h(),{href:`/host/inventory/${j}`,children:c.jsx("span",{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition cursor-pointer",children:"Cancel"})}),c.jsx("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-[#fad02f] text-black rounded hover:opacity-90 transition font-semibold",children:n?"Adding...":"Add Product"})]})]})]})}AddProduct.getLayout=function(e){return c.jsx(b.Z,{title:"Add Product - Guestify",children:e})};let x=(0,n.l)(a,"default"),y=(0,n.l)(a,"getStaticProps"),f=(0,n.l)(a,"getStaticPaths"),j=(0,n.l)(a,"getServerSideProps"),v=(0,n.l)(a,"config"),w=(0,n.l)(a,"reportWebVitals"),N=(0,n.l)(a,"unstable_getStaticProps"),S=(0,n.l)(a,"unstable_getStaticPaths"),P=(0,n.l)(a,"unstable_getStaticParams"),q=(0,n.l)(a,"unstable_getServerProps"),_=(0,n.l)(a,"unstable_getServerSideProps"),k=new s.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/host/inventory/[propertyId]/add-product",pathname:"/host/inventory/[propertyId]/add-product",bundlePath:"",filename:""},components:{App:o.default,Document:l()},userland:a})},2885:e=>{e.exports=require("@supabase/supabase-js")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[761,163,209,450,664,201,675,597,430],()=>__webpack_exec__(3698));module.exports=r})();